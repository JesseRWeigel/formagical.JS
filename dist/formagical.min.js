/*! Fomagical - v1.3.2 - 2015-08-21
* http://www.codeorelse.nl
* Copyright (c) 2015 Siebe Hiemstra; Licensed MIT */(function(){jQuery(function(){var a=a||a;return a.formagical=function(b,c){var d;return d="",this.settings={},this.jQueryelement=a(b),this.mostRecentFocusedElement=null,this.lastInteractionTime=0,this.startTime=0,this.submitted=!1,this.setState=function(a){return d=a},this.getState=function(){return d},this.getLastInteractionTime=function(){return lastInteractionTime},this.setLastInteractionTime=function(a){a=a},this.getMostRecentFocusedElement=function(){return mostRecentFocusedElement},this.setMostRecentFocusedElement=function(b){if("undefined"==typeof mostRecentFocusedElement){var c=this,d=new Date,e=d.getTime();this.settings.track.call(c,a(c.jQueryelement).attr("name"),"User started using form",e-c.startTime)}mostRecentFocusedElement=b},this.getSetting=function(a){return this.settings[a]},this.trackInAnalytics=function(a,b,c,d){("undefined"==typeof c||NaN==c)&&(c=0),ga("send","event","formagical",b,a,parseFloat((c/1024).toFixed(2)))},this.callSettingFunction=function(a,b){return null==b&&(b=[]),this.settings[a].apply(this,b)},this.init=function(){this.settings=a.extend({},this.defaults,c);var b=this,d=new Date,e=d.getTime();if(this.startTime=e,this.elementName=a(b.jQueryelement).attr("name"),b.settings.track.call(b,a(b.jQueryelement).attr("name"),"Form ready for stats"),"undefined"==typeof ga)throw new Error("Add GA to your page.");return this.jQueryelement.find("input, textarea").not("[type=checkbox],[type=submit]").each(function(){var c=a(this).attr("name");a(this).keydown(function(d){if(9!==d.keyCode&&27!=d.keyCode){var e=new Date,f=e.getTime();a(this).val(),a(this).data("valueBeforeTyping");if(!a(this).data("userStartedTypingInThisBox")){var g="Started typing";b.settings.track.call(b,c,g,f-a(this).data("userStartedFocusingAt"))}var h=this,i=b.settings.howManyMilliSecsAreAPause;a(h).val();b.settings.trackPauses&&f-a(h).data("lastTimeTypingInThisBox")>i&&a(this).data("userStartedTypingInThisBox")&&b.settings.track.call(b,c,"paused and continued ",f-a(this).data("lastTimeTypingInThisBox")),a(h).data("lastTimeTypingInThisBox",f),a(this).data("valueBeforeTyping",a(this).val()),a(this).data("userStartedTypingInThisBox",!0)}})}),this.jQueryelement.find("input, textarea, select").not("[type=checkbox],[type=submit]").each(function(){var c=a(this).attr("name");if("undefined"==typeof c||""==c)throw new Error("Every form element should have a name");a(this).blur(function(){var d=new Date,e=d.getTime(),f=a(this).val(),g=a(this).data("valueBeforeFocus"),h="from "+(""==g?"nothing":g)+" to "+f,i=f==g?" nothing":h;a(this).data("valueBeforeFocus",f),b.settings.track.call(b,c,"focusOut",e-a(this).data("startFocus"),i)}),a(this).focus(function(){var d=new Date,e=d.getTime();a(this).data("userStartedTypingInThisBox",!1),a(this).data("userStartedFocusingAt",e),a(this).data("lastTimeTypingInThisBox",e),b.setMostRecentFocusedElement(c),a(this).data("startFocus",e),a(this).data("valueBeforeFocus",a(this).val()),b.settings.track.call(b,c,"focus")})}),this.jQueryelement.bind("submit",function(){var c=(a(this).attr("name"),new Date),d=c.getTime();return b.submitted=!0,b.settings.track.call(b,"form","submitted",d-b.startTime),!0}),this.jQueryelement.find("input[type=checkbox]").each(function(){var c=a(this).attr("name");a(this).bind("change",function(){var d=new Date,e=(d.getTime(),a(this).prop("checked")),f=!e,g="from "+(""===f?"nothing":f)+" to "+e,h=e==f?" has not changed":g;b.settings.track.call(b,c,"changed",void 0,h),a(this).data("valueBeforeFocus",a(this).prop("checked")),b.setMostRecentFocusedElement(c)})}),this.jQueryelement.find("select").each(function(){a(this).bind("change",function(){var c=a(this).attr("name"),d=new Date,e=d.getTime();if(a(this).data("lastTimeSelectionTime"))var f=a(this).data("lastTimeSelectionTime")?e-a(this).data("lastTimeSelectionTime"):0;else var f=a(this).data("startFocus")?e-a(this).data("startFocus"):0;var g=a(this).val(),h=a(this).data("valueBeforeFocus"),i="from "+(""===h?"nothing":h)+" to "+g,j=g==h?" has not changed":i;b.settings.track.call(b,c,"changed",f,j),a(this).data("valueBeforeFocus",a(this).val()),a(this).data("lastTimeSelectionTime",e),b.setMostRecentFocusedElement(c)})}),this.setState("ready")},this.init(),this},a.formagical.prototype.defaults={howManyMilliSecsAreAPause:1500,trackPauses:!0,track:function(a,b,c,d){return this.trackInAnalytics(a,b,c,d)}},a.fn.formagical=function(b){return this.each(function(){var c;return void 0===a(this).data("formagical")?(c=new a.formagical(this,b),a(this).data("formagical",c)):void 0})}})}).call(this);